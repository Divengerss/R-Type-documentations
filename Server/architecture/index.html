
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../client/">
      
      
        <link rel="next" href="../Protocol/binary_protocol/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.2">
    
    
      
        <title>Architecture - R-Type Networked</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.b2ea3d00.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="R-Type Networked" class="md-header__button md-logo" aria-label="R-Type Networked" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            R-Type Networked
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="R-Type Networked" class="md-nav__button md-logo" aria-label="R-Type Networked" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    R-Type Networked
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Server
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Protocol
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Protocol
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Protocol/binary_protocol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary protocol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Packets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            Packets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Protocol/Packets/connection_request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connection request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Protocol/Packets/disconnection_request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disconnection request
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="architecture">Architecture</h1>
<p>The server should be self-explanatory when reading the source code, nevertheless, this documentation provides more details about the server workflow.</p>
<p>The server uses Asio non-boost C++20 to run.</p>
<p>Every network codes are under the <code>net</code> namespace included in the <code>Netcode.hpp</code>.</p>
<p>To instantiate a new server, simply call the <code>Server</code> class constructor and calls <code>startServer()</code> to start the server.
Just by doing that will run your server properly. However, you need to keep your program open or the server will close itself if the main returns.</p>
<p>Here is an example of implementation</p>
<pre><code class="language-cpp">#include &quot;Netcode.hpp&quot;

int main()
{
    asio::io_context ioContext;
    asio::io_service ioService;

    net::Server server(ioContext, ioService);

    server.startServer();

    while (true) {
        // Game logics
    }
}
</code></pre>
<p>The server constructor needs an Asio context and service. Those are used to run the network context and service from Asio.</p>
<p>Simply instanciate and pass them to the ctor.</p>
<h1 id="cfg-config-files">CFG Config files</h1>
<p>The configuration file is required to run the server with modified settings.
It provides the host and port to listen to.</p>
<p>Here is the <code>server.cfg</code> file located inside the <code>Release</code> directory.</p>
<pre><code class="language-conf"># Server config file

# IP Address to connect to
host=127.0.0.1

# Port of the host to connect to
port=12346
</code></pre>
<h1 id="constructorsdestructors">Constructors/Destructors</h1>
<h3 id="server-default-ctor">Server default ctor</h3>
<p><code>Server() = delete</code></p>
<p>The default constructor of the Server class is deleted to allow better workflow.</p>
<h3 id="server-ctor">Server ctor</h3>
<p><code>Server(asio::io_context &amp;ioContext, asio::io_context &amp;ioService)</code></p>
<p>Server class ctor, requires an Asio context as <code>asio::io_context</code> and an Asio server as <code>asio::io_context</code>.
The ctor will seek a <code>.cfg</code> file for its configuration as mention before. If the file format is corrupted, a value can't be found or the file is missing, the default values are applied.
If unchanged in the code, they will be 127.0.0.1 for the host and 12346 for the port number</p>
<h3 id="server">~Server</h3>
<p><code>~Server()</code></p>
<p>The <code>Server</code> class destructor.</p>
<h1 id="getters">Getters</h1>
<h3 id="getiocontext">getIoContext</h3>
<p><code>asio::io_context &amp;getIoContext() const noexcept</code></p>
<p>Returns the Asio IO context.</p>
<h3 id="getioservice">getIoService</h3>
<p><code>asio::io_context &amp;getIoService() const noexcept</code></p>
<p>Returns the Asio IO Serivice.</p>
<h3 id="gethost">getHost</h3>
<p><code>const std::string &amp;getHost() const noexcept</code></p>
<p>Returns the Host string.</p>
<h3 id="getport">getPort()</h3>
<p><code>std::uint16_t getPort() const noexcept</code></p>
<p>Returns the Port number as an unsigned 16bits integer</p>
<h3 id="getserverendpoint">getServerEndpoint</h3>
<p><code>const asio::ip::udp::endpoint &amp;getServerEndpoint() const noexcept</code></p>
<p>Returns the server endpoint, the endpoint corresponds to the communication terminaison of the server.</p>
<h3 id="getsocket">getSocket</h3>
<p><code>const asio::ip::udp::socket &amp;getSocket() const noexcept</code></p>
<p>Returns the server socket.</p>
<h3 id="getasioerrorcode">getAsioErrorCode</h3>
<p><code>const asio::error_code &amp;getAsioErrorCode() const noexcept</code></p>
<p>Returns the Asio error code. This value is set whenever an error occures in the Asio context.</p>
<h3 id="getclients">getClients</h3>
<p><code>const std::unordered_map&lt;std::string, asio::ip::udp::endpoint&gt; &amp;getClients() const noexcept</code></p>
<p>Returns the connected clients list as an unordered map. The key corresponds to the UUID of the client and the value its endpoint.</p>
<h1 id="setters">Setters</h1>
<h3 id="sethost">setHost</h3>
<p><code>void setHost(const std::string &amp;host)</code></p>
<p>Sets the server host.</p>
<h3 id="setport">setPort</h3>
<p><code>void setPort(std::uint16_t port)</code></p>
<p>Sets the server port</p>
<h3 id="setconnection">setConnection</h3>
<p><code>void setConnection(const std::string &amp;host, std::uint16_t port)</code></p>
<p>Sets the server host and port, This calls to the <code>setHost</code> and <code>setPort</code>.</p>
<h3 id="setserverinstance">setServerInstance</h3>
<p><code>static void setServerInstance(Server* instance)</code></p>
<p>Set the static variable <code>serverInstance</code> used to access class elements from the IO Service, mainly used to handle CTRL-C event.</p>
<h3 id="setpacket">setPacket</h3>
<p><code>void setPacket(T &amp;packet, packet::packetHeader &amp;header, T &amp;data)</code></p>
<p>Sets the packet from a <code>typename T</code> template packet, the packet header and its data.
This function will memory copy the <code>header</code> and <code>data</code> into the <code>packet</code>. The packet must be large enough to hold the header + data sizes.</p>
<h3 id="fillbufferfromrequest">fillBufferFromRequest</h3>
<p><code>void fillBufferFromRequest(T &amp;packet, std::size_t size)</code></p>
<p>Fills the <code>packet</code> given as parameter from the private variable <code>_packet</code> of the <code>Server</code> class.
This function will memory copy into <code>packet</code>.</p>
<h3 id="sendresponse">sendResponse</h3>
<p><code>void sendResponse(const packet::packetTypes &amp;type, T &amp;packet, const std::string cliUuid = "")</code></p>
<p>Builds a packet and sends it to all the clients if no <code>cliUuid</code> are provided.
The <code>packet</code> must not contains any header as it is generated using the <code>type</code> variable and the size of packet.
If the <code>cliUuid</code> is set, the packet will only be sent to the given client UUID. If the UUID is invalid or doesn't link to a valid client, the packet remains unsent.</p>
<h3 id="handlerequeststatus">handleRequestStatus</h3>
<p><code>void handleRequestStatus()</code></p>
<p>Handles each packets type.</p>
<h3 id="handlereceivefrom">handleReceiveFrom</h3>
<p><code>void handleReceiveFrom(const asio::error_code &amp;errCode, std::size_t bytesReceived)</code></p>
<p>Handles the received packet type. This function is called from the asynchronous receiver function from Asio <code>socket.async_receive_from</code>.</p>
<h3 id="receive">receive</h3>
<p><code>void receive()</code></p>
<p>Start the asynchronous receive operations.</p>
<h3 id="startserver">startServer</h3>
<p><code>void startServer()</code></p>
<p>Start the server and calls everything required. This function should be the only one called outside.</p>
<h3 id="signalhandler">signalHandler</h3>
<p><code>static void signalHandler(int signum)</code></p>
<p>Handles the signal events.</p>
<h3 id="addclient">addClient</h3>
<p><code>std::string addClient()</code></p>
<p>Adds a new client to the client lists and returns its new UUID.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.726fbb30.min.js"></script>
      
    
  </body>
</html>